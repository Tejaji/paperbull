generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              BigInt    @id @default(autoincrement())
  email           String    @unique
  phone           String    @unique
  username        String    @unique
  passwordHash    String?
  role            String    @default("free") // 'free' or 'premium'
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  accounts        Account[]
  
  @@map("users")
}

model OTP {
  id              BigInt    @id @default(autoincrement())
  phone           String
  otp             String
  expiresAt       DateTime
  verified        Boolean   @default(false)
  createdAt       DateTime  @default(now())
  
  @@index([phone])
  @@map("otps")
}

model Account {
  id              BigInt    @id @default(autoincrement())
  userId          BigInt
  balance         Decimal   @default(100000)
  createdAt       DateTime  @default(now())
  
  user            User      @relation(fields: [userId], references: [id])
  orders          Order[]
  positions       Position[]
  
  @@map("accounts")
}

model Index {
  id              BigInt    @id @default(autoincrement())
  symbol          String    @unique
  displayName     String
  lotSize         Int
  
  @@map("indices")
}

model OptionContract {
  id              BigInt    @id @default(autoincrement())
  tradingSymbol   String    @unique
  indexSymbol     String
  strike          Decimal
  optionType      String    // 'CE' or 'PE'
  expiryDate      String
  lotSize         Int
  
  positions       Position[]
  trades          Trade[]
  
  @@map("option_contracts")
}

model Order {
  id              BigInt    @id @default(autoincrement())
  accountId       BigInt
  tradingSymbol   String
  side            String    // 'BUY' or 'SELL'
  qty             Int
  orderType       String    // 'MARKET', 'LIMIT', 'SL', 'SL-M'
  price           Decimal?
  triggerPrice    Decimal?
  status          String    // 'PENDING', 'EXECUTED', 'CANCELLED'
  filledQty       Int       @default(0)
  avgPrice        Decimal   @default(0)
  createdAt       DateTime  @default(now())
  
  account         Account?  @relation(fields: [accountId], references: [id])
  trades          Trade[]
  
  @@map("orders")
}

model Trade {
  id              BigInt    @id @default(autoincrement())
  orderId         BigInt
  contractId      BigInt
  qty             Int
  price           Decimal
  createdAt       DateTime  @default(now())
  
  order           Order     @relation(fields: [orderId], references: [id])
  contract        OptionContract @relation(fields: [contractId], references: [id])
  
  @@map("trades")
}

model Position {
  id              BigInt    @id @default(autoincrement())
  accountId       BigInt
  contractId      BigInt
  qty             Int       // Positive for long, negative for short
  avgPrice        Decimal
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  account         Account   @relation(fields: [accountId], references: [id])
  contract        OptionContract @relation(fields: [contractId], references: [id])
  
  @@unique([accountId, contractId])
  @@map("positions")
}
model AppSettings {
  id                  BigInt   @id @default(autoincrement())
  premiumPrice        Int      @default(99)           // Premium price in INR
  freeCapital         Decimal  @default(100000)       // Free user capital
  premiumCapital      Decimal  @default(1000000)      // Premium user capital
  updatedAt           DateTime @updatedAt
  createdAt           DateTime @default(now())
}
model Announcement {
  id          BigInt   @id @default(autoincrement())
  title       String
  message     String
  targetRole  String   @default("all")  // "all", "premium", "free"
  type        String   @default("info") // "info", "warning", "success"
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  expiresAt   DateTime?
}

